<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/common.css" rel="stylesheet" />
		<link href="../css/newList.css" rel="stylesheet" />
		<link href="../css/newsArea.css" rel="stylesheet" />
		<title>新闻列表页</title>		
	</head>

	<body class="mui-fullscreen">
		
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-pages">
				</div>
			</div>
		</div>

		<!--新闻列表-->
		<div class="mui-content mui-page" id="newsCont">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div style="width:90%;float:left;background:#fff;">
					<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
						<div class="mui-scroll newsNav newsNavSub">
						</div>
					</div>
				</div>
		
				<div class="navAdd" style="width: 10%;float: right;"><a></a></div>
				<div style="clear: both;"></div>
				<div class="mui-slider-group">
					<div class="mui-slider-item mui-control-content"></div>
				</div>
			</div>
		</div>
		
		<!--新闻导航模板-->
		<script type="text/html" id="newsNav">
			{{each list v}}
			<a class="mui-control-item" href="#{{v.typeid}}">
				{{v.title}}
			</a>
			{{/each}}
			
		</script>
		 

		<!-- 这个模板是为了以后整个界面切换的，ID是为了绑定切换的，才写的模板 -->
		<script type="text/html" id="newsList">
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					{{if list.typeid == '5'}}
					<div id="BaiduMap" class="BaiduMap"><span class="areamap">点击选择城市 <i></i></span></div>
					{{/if}}	
					<ul class="mui-table-view">
						{{each list.Data v i}}
						<li class="mui-table-view-cell mui-media mediaId" id="{{v.id}}"  commentCount={{v.commentCount}}>
							{{if v.pics.length == 0}}
							<div class="mui-table-img" style="display: none;"></div>
							{{/if}} {{if v.pics.length == 1}}
							<div class="mui-table-img onePic"><img src="{{v.pics[0]}}" class="mui-media-object mui-pull-left" /></div>
							{{/if}}
							<div class="mui-table-text mui-media-body">
								<p class="mui-table-title muipurelyTitle">{{v.title}}</p>
								{{if v.pics.length >= 3}}
								<div class="mui-table-pics muipurelyImg" id="purelyImg">
									{{include "newsListPics" v}}
								</div>
								{{/if}}
								<div class="muipurelytext">
									<p class="mui-table-look muipurelylook clearfix">
										<span class="lookLeft">{{v.publishDate}}{{v.source}}</span>
										<span class="lookRight"><i class="look" style="margin-right: 8px;"></i>{{v.viewCount}}</span>
									</p>
								</div>
							</div>
						</li>
						{{/each}}
					</ul>
				</div>
			</div>
		</script>

		<script type="text/html" id="newsListPics">
			{{each pics v i}}
			<img src="{{v}}" attr='{{v}}'>
			{{/each}}
		</script>

		<script src="../js/flexable.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/mui.pullToRefresh.js"></script>
		<script src="../js/mui.pullToRefresh.material.js"></script>
		<script src="../js/jquery.js"></script>
		<script src="../js/artTemplate.js"></script>
		<script src="../js/template-web.js"></script>
		<script src="../js/mui.view.js"></script>
		<script src="../js/common.js"></script>

		
		
		<script type="text/javascript">
			mui.init();
			//初始化单页view
			var viewApi = mui('#app').view({
				defaultPage: '#newsCont'
			});
			$(document).ready(function() {
	function GetQueryString(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if(r != null) return unescape(r[2]);
		return null;
	}

	var userID = GetQueryString("userID");
	var group = $(".mui-slider-group");
	var cityname = GetQueryString("userID");
	$.ajax({
		url: 'http://47.93.192.128:5001/News/GetMyChannelList',
		dataType: 'json',
		type: 'post',
		data: {
			UserId: 10035
		},
		success: function(data) {
			var dataNav = data.Data.Data;
			console.log(dataNav);			//渲染新闻导航栏
			var str = template("newsNav", {
				list: dataNav
			})
			$(".newsNav").html(str).children(":first").addClass("mui-active");

			//根据新闻导航渲染对应页签
			var firstDiv = group.children(":first");
			for(var i = 0, len = dataNav.length; i < len; i++) {
				var id = dataNav[i].typeid;
				if(i == 0) {
					firstDiv.attr("id", id);
					var typeid = firstDiv.attr("id");
					$.ajax({
						url: "http://47.93.192.128:5001/News/NewsList",
						dataType: 'json',
						type: 'post',
						data: {
							pageindex: "", //number	否	页数，不填默认第一页	1
							typeid: typeid, //number	否	栏目类型id	1
							proid: "", //number	否	省id	3
							cityid: "", //number	否	城市id	5
							areaid: "" //number	否	区域id
						},
						success: function(data) {
							console.log(data);
							//这个模板生成的字符串整个放到外面大容器里
							data.Data.typeid = typeid
							var htmlStr = template("newsList", {
								list: data.Data
							});
							console.log(typeid);
							
							if(typeid==5){
								console.log($("#BaiduMap"))
								$("#BaiduMap").addClass("BaiduMapActive");
							}
							$("#" + typeid).html(htmlStr);
							group.children(":first").addClass("mui-active")
							$(".mediaId").click(function() {
								let id = $(this).attr('id'); // 获取id
								let commentCount=$(this).attr("commentCount");
								window.location.href = "newsDetailPage.html?id=" + id + "&userID="+10035+"&commentCount="+commentCount;
							});
							
						},
						error: function(XMLHttpRequest, textStatus, errorThrown) {
//							alert(textStatus);
						}
					});
				} else {
					firstDiv.clone().attr("id", id).appendTo(group);
				}

			}

		},
		error: function(XMLHttpRequest, textStatus, errorThrown) {
			alert(XMLHttpRequest.status);
		}
	});

	document.getElementById('slider').addEventListener('slide', function(e) {
		var slide = group.children().eq(e.detail.slideNumber);
		var typeid = slide.attr("id");
		console.log(typeid)
		$.ajax({
			url: "http://47.93.192.128:5001/News/NewsList",
			dataType: 'json',
			type: 'post',
			data: {
				pageindex: "", //number	否	页数，不填默认第一页	1
				typeid: typeid, //number	否	栏目类型id	1
				proid: "", //number	否	省id	3
				cityid: "", //number	否	城市id	5
				areaid: "" //number	否	区域id
			},
			success: function(data) {
				console.log(data);
				//这个模板生成的字符串整个放到外面大容器里
				data.Data.typeid = typeid
				console.log(data.Data)
				var htmlStr = template("newsList", {
					list: data.Data
				})
				console.log(typeid);
				$("#" + typeid).html(htmlStr);
				group.children(":first").addClass("mui-active")
				$(".mediaId").click(function() {
					let id = $(this).attr('id'); // 获取id
					let viewCount = $(this).attr('viewCount');
					let commentCount=$(this).attr("commentCount");
					window.location.href = "newsDetailPage.html?id=" + id + "&userID="+10035 +"&commentCount="+commentCount;
				});

				if(typeid==5){
					var area="area";
					$(".BaiduMap").click(function(){
						window.location.href="segue://type="+area;
					})
				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
//				alert(textStatus);
			}
		});
	});

	$(".navAdd").click(function() {
		window.location.href = "newsarea.html?userID=" + 10035;
	})

});
		</script>

	</body>

</html>