<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,  user-scalable=no">
		<title>test</title>
		<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<style>
			body {
				-webkit-overflow-scrolling: touch;
			}
			/*icon*/
			
			[class^=icon-] {
				display: inline-block
			}
			
			.icon-back {
				width: 44px;
				height: 44px;
				line-height: 44px
			}
			
			.icon-back::before {
				content: "";
				display: inline-block;
				width: 10px;
				height: 10px;
				vertical-align: middle;
				border-left: 2px solid #fff;
				border-bottom: 2px solid #fff;
				-webkit-transform: rotate(45deg);
				transform: rotate(45deg);
				-webkit-box-sizing: border-box;
				box-sizing: border-box
			}
			/*global*/
			
			.fl {
				float: left;
			}
			/*example*/
			
			.header {
				position: relative;
				padding: 0 44px;
				height: 44px;
				width: 100%;
				line-height: 44px;
				text-align: center;
				color: #fff;
				font-size: 14px;
				font-weight: bold;
				background: #009def;
				z-index: 1000;
			}
			
			.header .icon-back {
				position: absolute;
				left: 0;
				top: 0;
			}
			
			.list-group {
				margin-bottom: 0;
			}
			
			.tab-content .tab-panel {
				display: none;
			}
			
			.main-fixed {
				position: absolute;
				top: 0;
				left: 0;
				bottom: 0;
				right: 0;
				overflow-y: auto;
			}
			
			.header+.main-fixed {
				top: 44px;
			}
		</style>
	</head>

	<body>
		<div class="header">
			<a href="javascript: history.back();" class="fl">
				<span class="icon-back"></span>
			</a>
			下拉刷新+上拉加载 tab多个实例
		</div>
		<div class="main">
			<ul class="nav nav-tabs" style=" margin: 10px;">
				<li role="presentation">
					<a href="#">Tab 1</a>
				</li>
				<li role="presentation">
					<a href="#">Tab 2</a>
				</li>
				<li role="presentation">
					<a href="#">Tab 3</a>
				</li>
			</ul>
			<div class="tab-content" id="tabContent">
				<div class="tab-panel">
					<ul class="list-group">
						<li class="list-group-item">Tab 1 item 1</li>
						<li class="list-group-item">Tab 1 item 2</li>
						<li class="list-group-item">Tab 1 item 3</li>
						<li class="list-group-item">Tab 1 item 4</li>
						<li class="list-group-item">Tab 1 item 5</li>
						<li class="list-group-item">Tab 1 item 6</li>
						<li class="list-group-item">Tab 1 item 7</li>
						<li class="list-group-item">Tab 1 item 8</li>
						<li class="list-group-item">Tab 1 item 9</li>
						<li class="list-group-item">Tab 1 item 10</li>
						<li class="list-group-item">Tab 1 item 11</li>
						<li class="list-group-item">Tab 1 item 12</li>
						<li class="list-group-item">Tab 1 item 13</li>
						<li class="list-group-item">Tab 1 item 14</li>
						<li class="list-group-item">Tab 1 item 15</li>
					</ul>
				</div>
				<div class="tab-panel">
					<ul class="list-group">
						<li class="list-group-item">Tab 2 item 1</li>
						<li class="list-group-item">Tab 2 item 2</li>
						<li class="list-group-item">Tab 2 item 3</li>
						<li class="list-group-item">Tab 2 item 4</li>
						<li class="list-group-item">Tab 2 item 5</li>
						<li class="list-group-item">Tab 2 item 6</li>
						<li class="list-group-item">Tab 2 item 7</li>
						<li class="list-group-item">Tab 2 item 8</li>
						<li class="list-group-item">Tab 2 item 9</li>
						<li class="list-group-item">Tab 2 item 10</li>
						<li class="list-group-item">Tab 2 item 11</li>
						<li class="list-group-item">Tab 2 item 12</li>
						<li class="list-group-item">Tab 2 item 13</li>
						<li class="list-group-item">Tab 2 item 14</li>
						<li class="list-group-item">Tab 2 item 15</li>
					</ul>
				</div>
				<div class="tab-panel">
					<ul class="list-group">
						<li class="list-group-item">Tab 3 item 1</li>
						<li class="list-group-item">Tab 3 item 2</li>
						<li class="list-group-item">Tab 3 item 3</li>
						<li class="list-group-item">Tab 3 item 4</li>
						<li class="list-group-item">Tab 3 item 5</li>
						<li class="list-group-item">Tab 3 item 6</li>
						<li class="list-group-item">Tab 3 item 7</li>
						<li class="list-group-item">Tab 3 item 8</li>
						<li class="list-group-item">Tab 3 item 9</li>
						<li class="list-group-item">Tab 3 item 10</li>
						<li class="list-group-item">Tab 3 item 11</li>
						<li class="list-group-item">Tab 3 item 12</li>
						<li class="list-group-item">Tab 3 item 13</li>
						<li class="list-group-item">Tab 3 item 14</li>
						<li class="list-group-item">Tab 3 item 15</li>
					</ul>
				</div>
			</div>
		</div>

		<script src="http://cdn.bootcss.com/zepto/1.2.0/zepto.js"></script>
		<script src="../js/pull.min.js"></script>
		<script>
			var NavUrl = "http://47.93.192.128:5001/Train/TrainNavBar";
			var ListUrl = "http://47.93.192.128:5001/Train/TrainList";
			$.ajax({

				type: "post",
				url: ListUrl,
				data: {
					typeId: 22,
					pageindex: 1
				},
				datatype: "json",
				success: function(data) {
					data = eval('(' + data + ')');

					var index = 0;
					var currentClass = 'active';

					var $tabLi = $('.nav-tabs li');
					var $tabContent = $('#tabContent');
					var $tabPanel = $tabContent.find('.tab-panel');

					// init tab highlight
					$tabLi.eq(index).addClass(currentClass);
					$tabPanel.eq(index).show();

					var pullObj = {},
						pullKeysuffix = 'tabPanel_';

					for(var i = 0, len = $tabLi.length; i < len; i++) {
						pullObj[pullKeysuffix + i] = new Pull($tabPanel.eq(i).find('.list-group'), {

							lock: true, // 锁定操作，锁定后隐藏下拉刷新和上拉加载dom，解锁需调用实例的unlock方法。默认 false

							// 下拉刷新回调方法，如果不存在该方法，则不加载下拉dom
							onPullDown: function() {
								var currentIndex = index;
								setTimeout(function() {
									Math.round(Math.random() + 0.2) ? handlePullDownSuccess(currentIndex) : handlePullDownFailed(currentIndex);
								}, 1000);
							},

							onPullUp: function() {
								var currentIndex = index;
								setTimeout(function() {
									// pullInstance.pullUpSuccess();
									// pullInstance.pullUpFailed();
									// pullInstance.pullUpDone();
									Math.round(Math.random() + 0.2) ? handlePullUpSuccess(currentIndex) : handlePullUpFailed(currentIndex);
								}, 1000);
							},

						});
					}

					var pullUpTotal = [0, 0, 0],
						pullDownTotal = [0, 0, 0];

					// 处理下拉刷新成功
					function handlePullDownSuccess(currentIndex) {

						var count = Math.round(Math.random() * 10);
						var htmlArr = [];

						while(count) {
							count--;
							htmlArr.unshift(createList('Tab ' + (currentIndex + 1) + ' item pullDown ' + pullDownTotal[currentIndex]));
							pullDownTotal[currentIndex]++;
						}

						$tabPanel.eq(currentIndex).find('.list-group').prepend($(htmlArr.join('')));

						// 显示下拉刷新成功
						pullObj[pullKeysuffix + currentIndex].pullDownSuccess();
					}

					// 处理下拉刷新失败
					function handlePullDownFailed(currentIndex) {
						// 显示下拉刷新成功
						pullObj[pullKeysuffix + currentIndex].pullDownFailed();
					}

					function abc() {
						var fragment = document.createDocumentFragment(); //创建一个代码片段
						var li;
						for(var i = 0; i < data.Data.Data.length; i++) { //循环输出data中的数据
							li = document.createElement('li');
							li.className = 'mui-table-view-cell mui-media';
							li.innerHTML = '<a href="' + '"><img class="mui-pull-left" src="' +
								data.Data.Data[i].ThumbImg +
								'"><div class="saishi_text mui-media-body"><h2 class="">' +
								data.Data.Data[i].Title +
								'</h2><div class="mui-text-justify">内容简介1：' +
								data.Data.Data[i].BodyMsg +
								'</div></div></a><div class="saishi_time"><p class="peixun_p">培训时间1：' +
								data.Data.Data[i].TrainTime +
								'</p><button onclick="newBtn(this)" class="mui-btn-blue border-radius">快速报名</button></div>'
							fragment.appendChild(li);
						}
						return fragment;
					}
					//var a=abc();
					// 处理上拉加载成功
					function handlePullUpSuccess(currentIndex) {
//						var fragment = document.createDocumentFragment(); //创建一个代码片段
						var li;
						for(var i = 0; i < data.Data.Data.length; i++) { //循环输出data中的数据
									li = document.createElement('li');
									li.className = 'mui-table-view-cell mui-media';
									li.innerHTML = '<a href="' + '"><img class="mui-pull-left" src="' +
										data.Data.Data[i].ThumbImg +
										'"><div class="saishi_text mui-media-body"><h2 class="">' +
										data.Data.Data[i].Title +
										'</h2><div class="mui-text-justify">内容简介1：' +
										data.Data.Data[i].BodyMsg +
										'</div></div></a><div class="saishi_time"><p class="peixun_p">培训时间1：' +
										data.Data.Data[i].TrainTime +
										'</p><button onclick="newBtn(this)" class="mui-btn-blue border-radius">快速报名</button></div>'
//									fragment.appendChild(li);
								}
						var count = Math.round(Math.random() * 10),
							htmlArr = [];

						while(count) {
							count--;
							htmlArr.push(createList(li));
							pullUpTotal[currentIndex]++;
						}

						$tabPanel.eq(currentIndex).find('.list-group').append(htmlArr.join(''));

						if(pullUpTotal[currentIndex] >= 20) {
							pullObj[pullKeysuffix + currentIndex].pullUpDone();
						} else {
							pullObj[pullKeysuffix + currentIndex].pullUpSuccess();
						}
					}

					// 处理上拉加载失败
					function handlePullUpFailed(currentIndex) {
						pullObj[pullKeysuffix + currentIndex].pullUpFailed();
					}

					// 创建li dom
					function createList(str) {
						return '<li class="list-group-item">' + str + '</li>';
					}

					// 当前tab解锁
					pullObj[pullKeysuffix + index].unlock();

					// tab切换
					$('.nav-tabs li').on('click', function(e) {
						var $target = $(e.currentTarget);

						if(!$target.hasClass(currentClass)) {
							pullObj[pullKeysuffix + index].lock();
							index = $target.index();

							$target.siblings().removeClass(currentClass);
							$target.addClass(currentClass);

							$tabPanel.hide().eq(index).show();
							pullObj[pullKeysuffix + index].unlock();
						}
					});

				},
				error: function() {

				}
			});
		</script>

		<body>

</html>