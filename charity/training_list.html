<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>支教新闻列表</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">

		<link rel="stylesheet" href="../css/mui.min.css">
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.mui-bar~.mui-content .mui-fullscreen {
				top: 44px;
				height: auto;
			}
			
			.mui-pull-top-tips {
				position: absolute;
				top: -20px;
				left: 50%;
				margin-left: -25px;
				width: 40px;
				height: 40px;
				border-radius: 100%;
				z-index: 1;
			}
			
			.mui-bar~.mui-pull-top-tips {
				top: 24px;
			}
			
			.mui-pull-top-wrapper {
				width: 42px;
				height: 42px;
				display: block;
				text-align: center;
				background-color: #efeff4;
				border: 1px solid #ddd;
				border-radius: 25px;
				background-clip: padding-box;
				box-shadow: 0 4px 10px #bbb;
				overflow: hidden;
			}
			
			.mui-pull-top-tips.mui-transitioning {
				-webkit-transition-duration: 200ms;
				transition-duration: 200ms;
			}
			
			.mui-pull-top-tips .mui-pull-loading {
				/*-webkit-backface-visibility: hidden;
				-webkit-transition-duration: 400ms;
				transition-duration: 400ms;*/
				margin: 0;
			}
			
			.mui-pull-top-wrapper .mui-icon,
			.mui-pull-top-wrapper .mui-spinner {
				margin-top: 7px;
			}
			
			.mui-pull-top-wrapper .mui-icon.mui-reverse {
				/*-webkit-transform: rotate(180deg) translateZ(0);*/
			}
			
			.mui-pull-bottom-tips {
				text-align: center;
				background-color: #efeff4;
				font-size: 15px;
				line-height: 40px;
				color: #777;
			}
			
			.mui-pull-top-canvas {
				overflow: hidden;
				background-color: #fafafa;
				border-radius: 40px;
				box-shadow: 0 4px 10px #bbb;
				width: 40px;
				height: 40px;
				margin: 0 auto;
			}
			
			.mui-pull-top-canvas canvas {
				width: 40px;
			}
			
			.mui-slider-indicator.mui-segmented-control {
				background-color: #efeff4;
			}
			
			.mui-scroll .saiNav {
				width: 100% !important;
			}
			
			.mui-segmented-control.mui-scroll-wrapper .mui-control-item {
				padding: 0 30px;
			}
			
			#sliderSegmentedControl {
				width: 100% !important;
			}
		</style>
	</head>

	<body>

		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div class="mui-slider-group" style="background: white;">
					<div class="mui-slider-item mui-control-content" style="background: white;">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<li class="mui-table-view-cell">
										第1个选项卡子项-1
									</li>
									<li class="mui-table-view-cell">
										第1个选项卡子项-2
									</li>
									<li class="mui-table-view-cell">
										第1个选项卡子项-3
									</li>
									<li class="mui-table-view-cell">
										第1个选项卡子项-4
									</li>

								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/html" id="cont">
			
		</script>

		<script src="../js/mui.min.js"></script>
		<script src="../js/jquery.js"></script>
		<script src='../js/artTemplate.js'></script>
		<script src="../js/mui.pullToRefresh.js"></script>
		<script src="../js/mui.pullToRefresh.material.js"></script>

		<script>
			mui.init();

			function GetQueryString(name) {
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
				var r = window.location.search.substr(1).match(reg);
				if(r != null) return unescape(r[2]);
				return null;
			}

			var userID = GetQueryString("userID");
			console.log(userID)
			var urlPath = "http://47.93.192.128:5001/";
			var NavUrl = urlPath + "Train/TrainNavBar";
			var ListUrl = urlPath + "Train/TrainList";
			var group = $(".saiNav");
			var contGroup = $(".mui-slider-group");
			var pageindex = 1;

			

			function pullRefresh(typeid, pageindex) {
				console.log(typeid, pageindex)
				//阻尼系数
				var deceleration = mui.os.ios ? 0.003 : 0.0009;
				mui('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration: deceleration
				});
				mui.ready(function() {
					//循环初始化所有下拉刷新，上拉加载。
					mui.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
						mui(pullRefreshEl).pullToRefresh({
							down: {
								callback: function() {
									var self = this;
									setTimeout(function() {
										++pageindex;
										var ul = self.element.querySelector('.mui-table-view');

										add(ul, typeid, pageindex)
										self.endPullDownToRefresh();
									}, 1000);
								}
							}

						});
					});

					function add(ul, typeid, pageindex) {
						console.log(pageindex)
						$.ajax({
							type: "post",
							url: ListUrl,
							async: true,
							dataType: "json",
							data: {
								typeId: typeid,
								pageindex: pageindex
							},
							success: function(data) {
								console.log(data)
								if(data.Data.Success == true) {
									data.Data.typeid = typeid;
									var cont = data.Data.Data;
									console.log(cont);
									var fragment = document.createDocumentFragment();
									var li;
									for(var i = 0; i < cont.length; i++) {
										li = document.createElement("li");
										li.className = "mui-table-view-cell mui-media contID";
										li.setAttribute("id", cont[i].id);
										if(cont[i].ThumbImg.length !== 0) {
											li.innerHTML = '<a><img class="mui-media-object mui-pull-left" src="' + cont[i].ThumbImg +
												'" style="padding: 5px;"><div class="mui-media-body"><h5 class="mui-ellipsis tittle" style="width: 80%;overflow: hidden;">' + cont[i].Title +
												'</h5><p class="mui-ellipsis">' + cont[i].ShortMsg +
												'</p></div><div>培训时间：' + cont[i].TrainTime +
												'<button  class="mui-btn-blue border-radius mui-pull-right">快速报名</button></div></a>'
										} else if(cont[i].ThumbImg.length == 0) {
											li.innerHTML = '<a><div class="mui-media-body"><h5 class="mui-ellipsis tittle" style="width: 80%;overflow: hidden;">' + cont[i].Title +
												'</h5><p class="mui-ellipsis">' + cont[i].ShortMsg +
												'</p></div><div>培训时间：' + cont[i].TrainTime +
												'<button  class="mui-btn-blue border-radius mui-pull-right">快速报名</button></div></a>'
										}
										fragment.appendChild(li);
									}

									ul.insertBefore(fragment, ul.firstChild);
									if(typeid == 22) {
										address(typeid)
									}

									$(".contID").on("tap", function() {
										var id = $(this).attr("id")
										window.location.href = "trainingContent.html?id=" + id;
									})
								} else if(data.Data.Success == false) {
									mui.toast('没有更多了', {
										duration: '500',
										type: 'div'
									})
								}
							}
						});

					}

				});

			}
		</script>
	</body>

</html>